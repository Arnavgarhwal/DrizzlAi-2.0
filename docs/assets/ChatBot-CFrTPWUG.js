import{c as J,r as o,j as e,X as F,U as H,B as U}from"./index-DprxGLqD.js";import{M as $}from"./message-circle-Ac03D_UM.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const c=J("Bot",[["path",{d:"M12 8V4H8",key:"hb8ula"}],["rect",{width:"16",height:"12",x:"4",y:"8",rx:"2",key:"enze0r"}],["path",{d:"M2 14h2",key:"vft8re"}],["path",{d:"M20 14h2",key:"4cs60a"}],["path",{d:"M15 13v2",key:"1xurst"}],["path",{d:"M9 13v2",key:"rq6x2g"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const V=J("Send",[["path",{d:"M14.536 21.686a.5.5 0 0 0 .937-.024l6.5-19a.496.496 0 0 0-.635-.635l-19 6.5a.5.5 0 0 0-.024.937l7.93 3.18a2 2 0 0 1 1.112 1.11z",key:"1ffxy3"}],["path",{d:"m21.854 2.147-10.94 10.939",key:"12cjpa"}]]),L="https://xsxnepbujdicuyogrzah.supabase.co/functions/v1/chat",W=()=>{var v;const[y,g]=o.useState(!1),[n,d]=o.useState([]),[l,b]=o.useState(""),[m,j]=o.useState(!1),w=o.useRef(null),D=()=>{var t;(t=w.current)==null||t.scrollIntoView({behavior:"smooth"})};o.useEffect(()=>{D()},[n]);const E=async t=>{var k,C,z;const s=await fetch(L,{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InhzeG5lcGJ1amRpY3V5b2dyemFoIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjU2MjE3NjgsImV4cCI6MjA4MTE5Nzc2OH0.hIWHS-KTdkYM3ZIIlVNqhnmg4UAxyFFY-9U_RGHJpog"},body:JSON.stringify({messages:t})});if(!s.ok||!s.body)throw new Error("Failed to start stream");const x=s.body.getReader(),h=new TextDecoder;let a="",u="",I=!1;for(;!I;){const{done:R,value:T}=await x.read();if(R)break;a+=h.decode(T,{stream:!0});let p;for(;(p=a.indexOf(`
`))!==-1;){let r=a.slice(0,p);if(a=a.slice(p+1),r.endsWith("\r")&&(r=r.slice(0,-1)),r.startsWith(":")||r.trim()===""||!r.startsWith("data: "))continue;const M=r.slice(6).trim();if(M==="[DONE]"){I=!0;break}try{const S=(z=(C=(k=JSON.parse(M).choices)==null?void 0:k[0])==null?void 0:C.delta)==null?void 0:z.content;S&&(u+=S,d(i=>{const f=i[i.length-1];return(f==null?void 0:f.role)==="assistant"?i.map((O,A)=>A===i.length-1?{...O,content:u}:O):[...i,{role:"assistant",content:u}]}))}catch{a=r+`
`+a;break}}}},N=async()=>{if(!l.trim()||m)return;const t={role:"user",content:l.trim()},s=[...n,t];d(s),b(""),j(!0);try{await E(s)}catch(x){console.error("Chat error:",x),d(h=>[...h,{role:"assistant",content:"Sorry, I encountered an error. Please try again."}])}finally{j(!1)}},B=t=>{t.key==="Enter"&&!t.shiftKey&&(t.preventDefault(),N())};return e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>g(!0),className:`fixed bottom-16 right-6 z-50 w-14 h-14 rounded-full bg-gradient-to-br from-primary to-accent shadow-lg shadow-primary/30 flex items-center justify-center transition-all duration-300 hover:scale-110 hover:shadow-xl hover:shadow-primary/40 ${y?"scale-0 opacity-0":"scale-100 opacity-100"}`,"aria-label":"Open chat",children:e.jsx($,{className:"w-6 h-6 text-primary-foreground"})}),e.jsxs("div",{className:`fixed bottom-16 right-6 z-50 w-[380px] max-w-[calc(100vw-48px)] h-[500px] max-h-[calc(100vh-100px)] bg-card border border-border rounded-2xl shadow-2xl shadow-black/20 flex flex-col overflow-hidden transition-all duration-300 ${y?"scale-100 opacity-100":"scale-0 opacity-0 pointer-events-none"}`,children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-border bg-secondary/50",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-xl bg-gradient-to-br from-primary to-accent flex items-center justify-center",children:e.jsx(c,{className:"w-5 h-5 text-primary-foreground"})}),e.jsxs("div",{children:[e.jsx("div",{className:"font-display font-semibold text-foreground",children:"DrizzlAi Assistant"}),e.jsx("div",{className:"text-xs text-muted-foreground",children:"Online â€¢ Ready to help"})]})]}),e.jsx("button",{onClick:()=>g(!1),className:"w-8 h-8 rounded-lg hover:bg-secondary flex items-center justify-center transition-colors","aria-label":"Close chat",children:e.jsx(F,{className:"w-5 h-5 text-muted-foreground"})})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-4 space-y-4",children:[n.length===0&&e.jsxs("div",{className:"text-center py-8",children:[e.jsx("div",{className:"w-16 h-16 rounded-2xl bg-gradient-to-br from-primary/20 to-accent/20 flex items-center justify-center mx-auto mb-4",children:e.jsx(c,{className:"w-8 h-8 text-primary"})}),e.jsx("p",{className:"text-muted-foreground text-sm",children:"Hi! I'm DrizzlAi's assistant. How can I help you today?"})]}),n.map((t,s)=>e.jsxs("div",{className:`flex gap-3 ${t.role==="user"?"flex-row-reverse":""}`,children:[e.jsx("div",{className:`w-8 h-8 rounded-lg flex items-center justify-center flex-shrink-0 ${t.role==="user"?"bg-primary":"bg-gradient-to-br from-primary to-accent"}`,children:t.role==="user"?e.jsx(H,{className:"w-4 h-4 text-primary-foreground"}):e.jsx(c,{className:"w-4 h-4 text-primary-foreground"})}),e.jsx("div",{className:`max-w-[80%] px-4 py-2.5 rounded-2xl text-sm leading-relaxed ${t.role==="user"?"bg-primary text-primary-foreground rounded-tr-md":"bg-secondary text-foreground rounded-tl-md"}`,children:t.content})]},s)),m&&((v=n[n.length-1])==null?void 0:v.role)==="user"&&e.jsxs("div",{className:"flex gap-3 animate-fade-in",children:[e.jsx("div",{className:"w-8 h-8 rounded-lg bg-gradient-to-br from-primary to-accent flex items-center justify-center flex-shrink-0 animate-pulse-glow",children:e.jsx(c,{className:"w-4 h-4 text-primary-foreground"})}),e.jsx("div",{className:"bg-secondary px-4 py-3 rounded-2xl rounded-tl-md",children:e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx("span",{className:"w-2 h-2 bg-primary rounded-full animate-typing-dot",style:{animationDelay:"0ms"}}),e.jsx("span",{className:"w-2 h-2 bg-primary rounded-full animate-typing-dot",style:{animationDelay:"200ms"}}),e.jsx("span",{className:"w-2 h-2 bg-primary rounded-full animate-typing-dot",style:{animationDelay:"400ms"}})]})})]}),e.jsx("div",{ref:w})]}),e.jsx("div",{className:"p-4 border-t border-border bg-secondary/30",children:e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"text",value:l,onChange:t=>b(t.target.value),onKeyDown:B,placeholder:"Type a message...",className:"flex-1 bg-background border border-border rounded-xl px-4 py-2.5 text-sm text-foreground placeholder:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-primary/50 focus:border-primary transition-all"}),e.jsx(U,{onClick:N,disabled:!l.trim()||m,size:"icon",className:"w-10 h-10 rounded-xl",children:e.jsx(V,{className:"w-4 h-4"})})]})})]})]})};export{W as C,V as S};
